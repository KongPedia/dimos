#!/bin/bash

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

ROOT=$(git rev-parse --show-toplevel)
cd $ROOT

new_data=()

# Enable nullglob to make globs expand to nothing when not matching
shopt -s nullglob

# Iterate through all directories in tests/data
for dir_path in tests/data/*; do

    # Extract directory name
    dir_name=$(basename "$dir_path")

    # Skip .lfs directory if it exists
    [ "$dir_name" = ".lfs" ] && continue

    # Define compressed file path
    compressed_file="tests/data/.lfs/${dir_name}.tar.gz"

    # Check if compressed file already exists
    if [ -f "$compressed_file" ]; then
        continue
    fi

    new_data+=("$dir_name")
done

if [ ${#new_data[@]} -gt 0 ]; then
   echo -e "${RED}âœ—${NC} New test data detected at /tests/data:"
   echo -e "  ${GREEN}${new_data[@]}${NC}"
   echo -e "\nEither delete or run ${GREEN}./bin/lfs_push${NC}"
   echo -e "(lfs_push will compress the files into /tests/data/.lfs/, upload to LFS, and add them to your commit)"
   exit 1
fi
